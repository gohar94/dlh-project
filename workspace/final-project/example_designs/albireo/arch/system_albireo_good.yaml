architecture:
  version: 0.3
  subtree:
    - name: system_arch
      attributes:
        technology: 7nm
        latency: 0.2ns
      local:
        # Offchip DRAM is the source of all datatypes.
        # Assume DRAM is large enough to store all the data;
        # so no depth specification needed.
        - name: DRAM
          class: DRAM
          attributes:
            type: LPDDR4
            width: 64
            datawidth: 16
            block-size: 4
      subtree:
        - name: chip
          local:
            - name: shared_glb
              class: smartbuffer_SRAM
              attributes:
                technology: 7nm
                latency: 0.2ns
                memory_depth: 65536
                memory_width: 64
                n_banks: 32
                block-size: 4 # 65536 * 4 = 256KB
                word-bits: 16
                read_bandwidth: 16
                write_bandwidth: 16
                # TODO This is read from DRAM, still digital.
                network_read: D2A_NoC
                network_update: A2D_NoC
            - name: dummy_buffer
              class: dummy_storage
              attributes:
                technology: 7nm
                latency: 0.2ns
                depth: 0
                width: 16
                network_fill: D2A_NoC
                network_drain: A2D_NoC
            - name: D2A_NoC
              class: SimpleMulticast
              subclass: DAC_SimpleMulticast
              attributes:
                technology: 7nm
                latency: 0.2ns
                datawidth: 8
                DAC_datawidth: 8
                n_DAC_cycles: datawidth/DAC_datawidth
                n_PLCG_cols: 3
                n_PLCG_rows: 3
                action_name: transfer
                per_datatype_ERT: True
                multicast_factor_argument: num_destinations
            - name: A2D_NoC
              class: SimpleMulticast
              subclass: ADC_SimpleMulticast
              attributes:
                datawidth: 8
                ADC_datawidth: 8
                n_DAC_cycles: 1
                n_PE_cols: 3
                n_PE_rows: 3
                action_name: transfer
                per_datatype_ERT: True
                multicast_factor_argument: num_destinations
            - name: plcg_dummy_buffer[0..2]
              class: dummy_storage
              attributes:
                technology: 7nm
                latency: 0.2ns
                depth: 0
                width: 16
                meshX: 3
                meshY: 1
          subtree:
            - name: plcg[0..8]
              attributes:
                meshX: 3
                meshY: 3
              local:
                - name: weight_cache
                  class: smartbuffer_RF
                  attributes:
                    memory_depth: 4096
                    memory_width: 64
                    n_banks: 32
                    block-size: 4 # 4096 * 4 = 16KB
                    word-bits: 16
                    read_bandwidth: 16
                    write_bandwidth: 16
                    latency: 0.2ns
                    meshX: 3
                    meshY: 3
              subtree:
                - name: plcu[0..2]
                  attributes:
                    meshX: 3
                    meshY: 9
                  local:
                    - name: plcu_dummy_buffer
                      class: dummy_storage
                      attributes:
                        technology: 7nm
                        latency: 0.2ns
                        depth: 0
                        width: 16
                        meshX: 3
                        meshY: 9
                    - name: psumBuffer[0..4]
                      class: regfile
                      attributes:
                        technology: technology
                        latency: latency
                        width: 16
                        depth: 1
                        datawidth: 16
                        meshX: 15
                        meshY: 9
                    # Note:
                    # Each OMAC here is a *column* of the PLCU grid of 9 * 2 MRRs.
                    # There are 5 such columns in the PLCU.
                    - name: omacs[0..4]
                      class: plcu_compute
                      attributes:
                        technology: 7nm
                        datawidth: 8
                        plcu_datawidth: 8
                        nCycles: datawidth/plcu_datawidth
                        meshX: 15
                        meshY: 9
